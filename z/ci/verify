#!/usr/bin/env nix-shell
#!nix-shell ./deps.nix -i bash

function verify_docs() {
  declare -a docs=(README.adoc LICENSE)
  declare failed=false

  for d in "${docs[@]}"; do
    echo -ne "Verify asciidoc format of ${d}: "
    if asciidoc --out-file=/dev/null "${d}"; then
      echo "OK"
    else
      echo "FAIL"
      failed=true
    fi
  done
  if "${failed}"; then
    return 1
  fi
}

function verify_haskell() {
  nix-env --version

  cabal build
  cabal test
  cabal bench
}

set -eu
set -o pipefail
asciidoc --version
verify_docs
verify_haskell
